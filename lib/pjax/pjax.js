"use strict";function _typeof3(t){return(_typeof3="function"==typeof Symbol&&"symbol"===_typeof3(Symbol.iterator)?function(t){return void 0===t?"undefined":_typeof3(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":void 0===t?"undefined":_typeof3(t)})(t)}!function(t){"object"===("undefined"==typeof exports?"undefined":_typeof3(exports))&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Pjax=t()}(function(){return function s(r,a,l){function c(e,t){if(!a[e]){if(!r[e]){var o="function"==typeof require&&require;if(!t&&o)return o(e,!0);if(u)return u(e,!0);var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}var i=a[e]={exports:{}};r[e][0].call(i.exports,function(t){return c(r[e][1][t]||t)},i,i.exports,s,r,a,l)}return a[e].exports}for(var u="function"==typeof require&&require,t=0;t<l.length;t++)c(l[t]);return c}({1:[function(i,t,e){function o(t){this.state={numPendingSwitches:0,href:null,options:null},this.options=n(t),this.log("Pjax options",this.options),this.options.scrollRestoration&&"scrollRestoration"in history&&(history.scrollRestoration="manual"),this.maxUid=this.lastUid=a(),this.parseDOM(document),l(window,"popstate",function(t){var e;t.state&&((e=u(this.options)).url=t.state.url,e.title=t.state.title,e.history=!1,e.scrollPos=t.state.scrollPos,t.state.uid<this.lastUid?e.backward=!0:e.forward=!0,this.lastUid=t.state.uid,this.loadUrl(t.state.url,e))}.bind(this))}var r=i("./lib/foreach-els"),n=i("./lib/parse-options"),s=i("./lib/switches"),a=i("./lib/uniqueid"),l=i("./lib/events/on"),c=i("./lib/events/trigger"),u=i("./lib/util/clone"),h=i("./lib/util/contains"),d=i("./lib/util/extend"),f=i("./lib/util/noop");if(o.switches=s,o.prototype={log:i("./lib/proto/log"),getElements:function(t){return t.querySelectorAll(this.options.elements)},parseDOM:function(t){var e=i("./lib/proto/parse-element");r(this.getElements(t),e,this)},refresh:function(t){this.parseDOM(t||document)},reload:function(){window.location.reload()},attachLink:i("./lib/proto/attach-link"),attachForm:i("./lib/proto/attach-form"),forEachSelectors:function(t,e,o){return i("./lib/foreach-selectors").bind(this)(this.options.selectors,t,e,o)},switchSelectors:function(t,e,o,n){return i("./lib/switches-selectors").bind(this)(this.options.switches,this.options.switchesOptions,t,e,o,n)},latestChance:function(t){window.location=t},onSwitch:function(){c(window,"resize scroll"),this.state.numPendingSwitches--,0===this.state.numPendingSwitches&&this.afterAllSwitches()},loadContent:function(t,e){if("string"==typeof t){var o=document.implementation.createHTMLDocument("pjax"),n=t.match(/<html[^>]+>/gi);if(n&&n.length&&(n=n[0].match(/\s?[a-z:]+(?:=['"][^'">]+['"])*/gi)).length&&(n.shift(),n.forEach(function(t){var e=t.trim().split("=");1===e.length?o.documentElement.setAttribute(e[0],!0):o.documentElement.setAttribute(e[0],e[1].slice(1,-1))})),o.documentElement.innerHTML=t,this.log("load content",o.documentElement.attributes,o.documentElement.innerHTML.length),document.activeElement&&h(document,this.options.selectors,document.activeElement))try{document.activeElement.blur()}catch(t){}this.switchSelectors(this.options.selectors,o,document,e)}else c(document,"pjax:complete pjax:error",e)},abortRequest:i("./lib/abort-request"),doRequest:i("./lib/send-request"),handleResponse:i("./lib/proto/handle-response"),loadUrl:function(t,e){e="object"===(void 0===e?"undefined":_typeof3(e))?d({},this.options,e):u(this.options),this.log("load href",t,e),this.abortRequest(this.request),c(document,"pjax:send",e),this.request=this.doRequest(t,e,this.handleResponse.bind(this))},afterAllSwitches:function(){var t=Array.prototype.slice.call(document.querySelectorAll("[autofocus]")).pop();t&&document.activeElement!==t&&t.focus(),this.options.selectors.forEach(function(t){r(document.querySelectorAll(t),function(t){})});var e=this.state;if(e.options.history&&(window.history.state||(this.lastUid=this.maxUid=a(),window.history.replaceState({url:window.location.href,title:document.title,uid:this.maxUid,scrollPos:[0,0]},document.title)),this.lastUid=this.maxUid=a(),window.history.pushState({url:e.href,title:e.options.title,uid:this.maxUid,scrollPos:[0,0]},e.options.title,e.href)),this.forEachSelectors(function(t){this.parseDOM(t)},this),c(document,"pjax:complete pjax:success",e.options),"function"==typeof e.options.analytics&&e.options.analytics(),e.options.history){var o=document.createElement("a");if(o.href=this.state.href,o.hash){var n=o.hash.slice(1),n=decodeURIComponent(n),i=0,s=document.getElementById(n)||document.getElementsByName(n)[0];if(s&&s.offsetParent)for(;i+=s.offsetTop,s=s.offsetParent;);window.scrollTo(0,i)}else!1!==e.options.scrollTo&&(1<e.options.scrollTo.length?window.scrollTo(e.options.scrollTo[0],e.options.scrollTo[1]):window.scrollTo(0,e.options.scrollTo))}else e.options.scrollRestoration&&e.options.scrollPos&&window.scrollTo(e.options.scrollPos[0],e.options.scrollPos[1]);this.state={numPendingSwitches:0,href:null,options:null}}},o.isSupported=i("./lib/is-supported"),o.isSupported())t.exports=o;else{var p,m=f;for(p in o.prototype)o.prototype.hasOwnProperty(p)&&"function"==typeof o.prototype[p]&&(m[p]=f);t.exports=m}},{"./lib/abort-request":2,"./lib/events/on":3,"./lib/events/trigger":4,"./lib/foreach-els":5,"./lib/foreach-selectors":6,"./lib/is-supported":7,"./lib/parse-options":8,"./lib/proto/attach-form":9,"./lib/proto/attach-link":10,"./lib/proto/handle-response":11,"./lib/proto/log":12,"./lib/proto/parse-element":13,"./lib/send-request":14,"./lib/switches":16,"./lib/switches-selectors":15,"./lib/uniqueid":17,"./lib/util/clone":18,"./lib/util/contains":19,"./lib/util/extend":20,"./lib/util/noop":21}],2:[function(t,e,o){var n=t("./util/noop");e.exports=function(t){t&&t.readyState<4&&(t.onreadystatechange=n,t.abort())}},{"./util/noop":21}],3:[function(t,e,o){var i=t("../foreach-els");e.exports=function(t,e,o,n){(e="string"==typeof e?e.split(" "):e).forEach(function(e){i(t,function(t){t.addEventListener(e,o,n)})})}},{"../foreach-els":5}],4:[function(t,e,o){var i=t("../foreach-els");e.exports=function(e,t,n){(t="string"==typeof t?t.split(" "):t).forEach(function(t){var o=document.createEvent("HTMLEvents");o.initEvent(t,!0,!0),o.eventName=t,n&&Object.keys(n).forEach(function(t){o[t]=n[t]}),i(e,function(t){var e=!1;t.parentNode||t===document||t===window||(e=!0,document.body.appendChild(t)),t.dispatchEvent(o),e&&t.parentNode.removeChild(t)})})}},{"../foreach-els":5}],5:[function(t,e,o){e.exports=function(t,e,o){return t instanceof HTMLCollection||t instanceof NodeList||t instanceof Array?Array.prototype.forEach.call(t,e,o):e.call(o,t)}},{}],6:[function(t,e,o){var i=t("./foreach-els");e.exports=function(t,e,o,n){n=n||document,t.forEach(function(t){i(n.querySelectorAll(t),e,o)})}},{"./foreach-els":5}],7:[function(t,e,o){e.exports=function(){return window.history&&window.history.pushState&&window.history.replaceState&&!navigator.userAgent.match(/((iPod|iPhone|iPad).+\bOS\s+[1-4]\D|WebApps\/.+CFNetwork)/)}},{}],8:[function(t,e,o){var n=t("./switches");function i(){window._gaq&&_gaq.push(["_trackPageview"]),window.ga&&ga("send","pageview",{page:location.pathname,title:document.title})}e.exports=function(t){return(t=t||{}).elements=t.elements||"a[href], form[action]",t.selectors=t.selectors||["title",".js-Pjax"],t.switches=t.switches||{},t.switchesOptions=t.switchesOptions||{},t.history=void 0===t.history||t.history,t.analytics="function"==typeof t.analytics||!1===t.analytics?t.analytics:i,t.scrollTo=void 0===t.scrollTo?0:t.scrollTo,t.scrollRestoration=void 0===t.scrollRestoration||t.scrollRestoration,t.cacheBust=void 0===t.cacheBust||t.cacheBust,t.debug=t.debug||!1,t.timeout=t.timeout||0,t.currentUrlFullReload=void 0!==t.currentUrlFullReload&&t.currentUrlFullReload,t.switches.head||(t.switches.head=n.switchElementsAlt),t.switches.body||(t.switches.body=n.switchElementsAlt),t}},{"./switches":16}],9:[function(t,e,o){function n(t,e){var o,n,i;a(e)||((o=s(this.options)).requestOptions={requestUrl:t.getAttribute("action")||window.location.href,requestMethod:t.getAttribute("method")||"GET"},(n=document.createElement("a")).setAttribute("href",o.requestOptions.requestUrl),(i=function(t,e){if(t.protocol!==window.location.protocol||t.host!==window.location.host)return"external";if(t.hash&&t.href.replace(t.hash,"")===window.location.href.replace(location.hash,""))return"anchor";if(t.href===window.location.href.split("#")[0]+"#")return"anchor-empty";if(e.currentUrlFullReload&&t.href===window.location.href.split("#")[0])return"reload"}(n,o))?t.setAttribute(r,i):(e.preventDefault(),"multipart/form-data"===t.enctype?o.requestOptions.formData=new FormData(t):o.requestOptions.requestParams=function(t){for(var e,o=[],n=t.elements,i=0;i<n.length;i++){var s=n[i],r=s.tagName.toLowerCase();if(s.name&&void 0!==s.attributes&&"button"!==r){var a=s.attributes.type;if(!a||"checkbox"!==a.value&&"radio"!==a.value||s.checked){var l=[];if("select"===r)for(var c=0;c<s.options.length;c++)(e=s.options[c]).selected&&!e.disabled&&l.push(e.hasAttribute("value")?e.value:e.text);else l.push(s.value);for(var u=0;u<l.length;u++)o.push({name:encodeURIComponent(s.name),value:encodeURIComponent(l[u])})}}}return o}(t),t.setAttribute(r,"submit"),o.triggerElement=t,this.loadUrl(n.href,o)))}var i=t("../events/on"),s=t("../util/clone"),r="data-pjax-state";var a=function(t){return t.defaultPrevented||!1===t.returnValue};e.exports=function(e){var o=this;e.setAttribute(r,""),i(e,"submit",function(t){n.call(o,e,t)})}},{"../events/on":3,"../util/clone":18}],10:[function(t,e,o){function n(t,e){if(!a(e)){var o=s(this.options),n=function(t,e){if(1<e.which||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey)return"modifier";if(t.protocol!==window.location.protocol||t.host!==window.location.host)return"external";if(t.hash&&t.href.replace(t.hash,"")===window.location.href.replace(location.hash,""))return"anchor";if(t.href===window.location.href.split("#")[0]+"#")return"anchor-empty"}(t,e);if(n)t.setAttribute(r,n);else{if(e.preventDefault(),this.options.currentUrlFullReload&&t.href===window.location.href.split("#")[0])return t.setAttribute(r,"reload"),void this.reload();t.setAttribute(r,"load"),o.triggerElement=t,this.loadUrl(t.href,o)}}}var i=t("../events/on"),s=t("../util/clone"),r="data-pjax-state";var a=function(t){return t.defaultPrevented||!1===t.returnValue};e.exports=function(e){var o=this;e.setAttribute(r,""),i(e,"click",function(t){n.call(o,e,t)}),i(e,"keyup",function(t){13===t.keyCode&&n.call(o,e,t)}.bind(this))}},{"../events/on":3,"../util/clone":18}],11:[function(t,e,o){var l=t("../util/clone"),c=t("../uniqueid"),u=t("../events/trigger");e.exports=function(t,e,o,n){if((n=l(n||this.options)).request=e,!1!==t){var i=window.history.state||{};window.history.replaceState({url:i.url||window.location.href,title:i.title||document.title,uid:i.uid||c(),scrollPos:[document.documentElement.scrollLeft||document.body.scrollLeft,document.documentElement.scrollTop||document.body.scrollTop]},document.title,window.location.href);var s=o;e.responseURL?o!==e.responseURL&&(o=e.responseURL):e.getResponseHeader("X-PJAX-URL")?o=e.getResponseHeader("X-PJAX-URL"):e.getResponseHeader("X-XHR-Redirected-To")&&(o=e.getResponseHeader("X-XHR-Redirected-To"));var r=document.createElement("a");r.href=s;var a=r.hash;r.href=o,a&&!r.hash&&(r.hash=a,o=r.href),this.state.href=o,this.state.options=n;try{this.loadContent(t,n)}catch(t){if(u(document,"pjax:error",n),this.options.debug)throw t;return console&&console.error&&console.error("Pjax switch fail: ",t),this.latestChance(o)}}else u(document,"pjax:complete pjax:error",n)}},{"../events/trigger":4,"../uniqueid":17,"../util/clone":18}],12:[function(t,e,o){e.exports=function(){this.options.debug&&console&&("function"==typeof console.log?console.log.apply(console,arguments):console.log&&console.log(arguments))}},{}],13:[function(t,e,o){var n="data-pjax-state";e.exports=function(t){switch(t.tagName.toLowerCase()){case"a":t.hasAttribute(n)||this.attachLink(t);break;case"form":t.hasAttribute(n)||this.attachForm(t);break;default:throw"Pjax can only be applied on <a> or <form> submit"}}},{}],14:[function(t,e,o){var h=t("./util/update-query-string");e.exports=function(e,o,n){var t,i=(o=o||{}).requestOptions||{},s=(i.requestMethod||"GET").toUpperCase(),r=i.requestParams||null,a=i.formData||null,l=null,c=new XMLHttpRequest,u=o.timeout||0;if(c.onreadystatechange=function(){4===c.readyState&&(200===c.status?n(c.responseText,c,e,o):0!==c.status&&n(null,c,e,o))},c.onerror=function(t){console.log(t),n(null,c,e,o)},c.ontimeout=function(){n(null,c,e,o)},r&&r.length)switch(t=r.map(function(t){return t.name+"="+t.value}).join("&"),s){case"GET":e=e.split("?")[0],e+="?"+t;break;case"POST":l=t}else a&&(l=a);return o.cacheBust&&(e=h(e,"t",Date.now())),c.open(s,e,!0),c.timeout=u,c.setRequestHeader("X-Requested-With","XMLHttpRequest"),c.setRequestHeader("X-PJAX","true"),c.setRequestHeader("X-PJAX-Selectors",JSON.stringify(o.selectors)),l&&"POST"===s&&!a&&c.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),c.send(l),c}},{"./util/update-query-string":22}],15:[function(t,e,o){var n=t("./foreach-els"),u=t("./switches");e.exports=function(r,a,t,e,o,l){var c=[];t.forEach(function(i){var t=e.querySelectorAll(i),s=o.querySelectorAll(i);if(this.log&&this.log("Pjax switch",i,t,s),t.length!==s.length)throw"DOM doesn’t look the same on new loaded page: ’"+i+"’ - new "+t.length+", old "+s.length;n(t,function(t,e){var o=s[e];this.log&&this.log("newEl",t,"oldEl",o);var n=r[i]?r[i].bind(this,o,t,l,a[i]):u.outerHTML.bind(this,o,t,l);c.push(n)},this)},this),this.state.numPendingSwitches=c.length,c.forEach(function(t){t()})}},{"./foreach-els":5,"./switches":16}],16:[function(t,e,o){var h=t("./events/on");e.exports={outerHTML:function(t,e){t.outerHTML=e.outerHTML,this.onSwitch()},innerHTML:function(t,e){t.innerHTML=e.innerHTML,""===e.className&&t.removeAttribute("class"),this.onSwitch()},switchElementsAlt:function(t,e){if(t.innerHTML=e.innerHTML,e.hasAttributes())for(var o=e.attributes,n=0;n<o.length;n++)t.attributes.setNamedItem(o[n].cloneNode());this.onSwitch()},replaceNode:function(t,e){t.parentNode.replaceChild(e,t),this.onSwitch()},sideBySide:function(t,e,o,n){var i=Array.prototype.forEach,s=[],r=[],a=document.createDocumentFragment(),l="animationend webkitAnimationEnd MSAnimationEnd oanimationend",c=0,u=function(t){t.target===t.currentTarget&&--c<=0&&s&&(s.forEach(function(t){t.parentNode&&t.parentNode.removeChild(t)}),r.forEach(function(t){t.className=t.className.replace(t.getAttribute("data-pjax-classes"),""),t.removeAttribute("data-pjax-classes")}),s=r=null,this.onSwitch())}.bind(this);n=n||{},i.call(t.childNodes,function(t){s.push(t),t.classList&&!t.classList.contains("js-Pjax-remove")&&(t.hasAttribute("data-pjax-classes")&&(t.className=t.className.replace(t.getAttribute("data-pjax-classes"),""),t.removeAttribute("data-pjax-classes")),t.classList.add("js-Pjax-remove"),n.callbacks&&n.callbacks.removeElement&&n.callbacks.removeElement(t),n.classNames&&(t.className+=" "+n.classNames.remove+" "+(o.backward?n.classNames.backward:n.classNames.forward)),c++,h(t,l,u,!0))}),i.call(e.childNodes,function(t){var e;t.classList&&(e="",n.classNames&&(e=" js-Pjax-add "+n.classNames.add+" "+(o.backward?n.classNames.forward:n.classNames.backward)),n.callbacks&&n.callbacks.addElement&&n.callbacks.addElement(t),t.className+=e,t.setAttribute("data-pjax-classes",e),r.push(t),a.appendChild(t),c++,h(t,l,u,!0))}),t.className=e.className,t.appendChild(a)}}},{"./events/on":3}],17:[function(t,e,o){var n;e.exports=(n=0,function(){var t="pjax"+(new Date).getTime()+"_"+n;return n++,t})},{}],18:[function(t,e,o){e.exports=function(t){if(null===t||"object"!==(void 0===t?"undefined":_typeof3(t)))return t;var e,o=t.constructor();for(e in t)t.hasOwnProperty(e)&&(o[e]=t[e]);return o}},{}],19:[function(t,e,o){e.exports=function(t,e,o){for(var n=0;n<e.length;n++)for(var i=t.querySelectorAll(e[n]),s=0;s<i.length;s++)if(i[s].contains(o))return!0;return!1}},{}],20:[function(t,e,o){e.exports=function(t){if(null==t)return null;for(var e=Object(t),o=1;o<arguments.length;o++){var n=arguments[o];if(null!=n)for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}},{}],21:[function(t,e,o){e.exports=function(){}},{}],22:[function(t,e,o){e.exports=function(t,e,o){var n=new RegExp("([?&])"+e+"=.*?(&|$)","i"),i=-1!==t.indexOf("?")?"&":"?";return t.match(n)?t.replace(n,"$1"+e+"="+o+"$2"):t+i+e+"="+o}},{}]},{},[1])(1)});