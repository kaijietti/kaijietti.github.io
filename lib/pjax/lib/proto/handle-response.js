"use strict";var clone=require("../util/clone"),newUid=require("../uniqueid"),trigger=require("../events/trigger");module.exports=function(e,t,o,r){if((r=clone(r||this.options)).request=t,!1!==e){var s=window.history.state||{};window.history.replaceState({url:s.url||window.location.href,title:s.title||document.title,uid:s.uid||newUid(),scrollPos:[document.documentElement.scrollLeft||document.body.scrollLeft,document.documentElement.scrollTop||document.body.scrollTop]},document.title,window.location.href);var n=o;t.responseURL?o!==t.responseURL&&(o=t.responseURL):t.getResponseHeader("X-PJAX-URL")?o=t.getResponseHeader("X-PJAX-URL"):t.getResponseHeader("X-XHR-Redirected-To")&&(o=t.getResponseHeader("X-XHR-Redirected-To"));var i=document.createElement("a");i.href=n;var c=i.hash;i.href=o,c&&!i.hash&&(i.hash=c,o=i.href),this.state.href=o,this.state.options=r;try{this.loadContent(e,r)}catch(e){if(trigger(document,"pjax:error",r),this.options.debug)throw e;return console&&console.error&&console.error("Pjax switch fail: ",e),this.latestChance(o)}}else trigger(document,"pjax:complete pjax:error",r)};